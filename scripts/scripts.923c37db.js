"use strict";navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,angular.module("voiceMemoRsApp",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("voiceMemoRsApp").controller("MainCtrl",["$scope","VoicememoResource",function(a,b){function c(b){a.mediaRecorder=new MediaStreamRecorder(b),a.mediaRecorder.mimeType="audio/ogg",a.mediaRecorder.ondataavailable=function(b){URL.createObjectURL(b);console.log("data available",b),a.audioRecording=b}}function d(a){console.error("media error",a)}var e=function(){var a={audio:!0};navigator.getUserMedia(a,c,d)},f=function(){remoteStorage.access.claim("voicememos","rw"),remoteStorage.displayWidget()};a.startRecording=function(){a.recording=!0,a.mediaRecorder.start(6e5)},a.stopRecording=function(){a.mediaRecorder.stop(),a.recording=!1},a.saveRecording=function(){b.addMemo(a.memoTitle,a.audioRecording).then(function(){console.log("save completed",arguments)})},a.recording=!1,e(),f()}]),angular.module("voiceMemoRsApp").service("VoicememoResource",function(){return RemoteStorage.defineModule("voicememos",function(a){a.declareType("voicememo",{description:"A memo in spoken language",type:"object",properties:{id:{type:"string",format:"id"},title:{type:"string"},file:{type:"object",properties:{mimeType:{type:"string"},size:{type:"number"},url:{type:"string",format:"uri"}},required:["mimeType","size","url"]}},required:["id"]});var b=function(a){console.log(a)},c=function(b,c){var d=promising(),e="recordings/"+b,f=new FileReader;return f.onload=function(){a.storeFile(c.type,e,this.result).then(function(){d.fulfill(a.getItemURL(e))})},f.readAsArrayBuffer(c),d},d=function(d,e){var f=(new Date).getTime().toString(),g=function(b){return a.storeObject("voicememo",f,{id:f,title:d||"",file:{mimeType:e.type,size:e.size,url:b}})};return c(f,e).then(g).then(function(){},b)};return{exports:{addMemo:d}}}),remoteStorage.voicememos});